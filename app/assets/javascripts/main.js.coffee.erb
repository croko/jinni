ready = ->
  window.NestedFormEvents::insertFields = (content, assoc, link) ->
    $tr = $(link).parents("tr")
    $(content).insertBefore $tr
    return

  $('#lightbox a').nivoLightbox({
    effect: 'fall'
  });

  $('.datepicker').datetimepicker({
    language: 'ru',
    pickTime: false
  })

  $('#project_tag_list').tokenInput '/projects/tags.json',
    theme: 'facebook'
    minChars: 3
    allowCustomEntry: true
    allowFreeTagging: true
    preventDuplicates: true
    hintText: "Введите текст для поиска"
    searchingText: 'Поиск ...'
    noResultsText: 'Ничего не найдено'
    prePopulate: $('#project_tag_list').data('load')

  $('.use_backstretch').backstretch([
    "<%= asset_path 'bg/ag1.jpg' %>"
  , "<%= asset_path 'bg/ag2.jpg' %>"
  , "<%= asset_path 'bg/ag3.jpg' %>"
  ], {duration: 3000, fade: 750})

  disqus_shortname = "jinni"
  (->
    s = document.createElement("script")
    s.async = true
    s.type = "text/javascript"
    s.src = "//" + disqus_shortname + ".disqus.com/count.js"
    (document.getElementsByTagName("HEAD")[0] or document.getElementsByTagName("BODY")[0]).appendChild s
    return
  )()

  (->
    dsq = document.createElement("script")
    dsq.type = "text/javascript"
    dsq.async = true
    dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js"
    (document.getElementsByTagName("head")[0] or document.getElementsByTagName("body")[0]).appendChild dsq
    return
  )()

$(document).ready(ready)
$(document).on('page:load', ready)
window.ready = ready
